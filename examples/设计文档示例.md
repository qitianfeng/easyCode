# 用户管理系统技术设计文档

## 1. 系统概述

**项目名称**：用户管理系统  
**系统描述**：提供用户注册、登录、个人信息管理、权限控制等功能的综合管理系统  
**项目目标**：构建一个安全、高效、易扩展的用户管理平台  

## 2. 架构设计

**架构模式**：分层架构  
**设计原则**：单一职责、开闭原则、依赖倒置  

### 系统组件
- **表现层**：Spring MVC Controllers，负责HTTP请求处理
- **业务逻辑层**：Service层，实现业务规则和流程控制
- **数据访问层**：Repository层，封装数据访问逻辑
- **数据库层**：MySQL数据库，持久化存储

### 层次结构
```
┌─────────────────┐
│   Controller    │  ← 表现层
├─────────────────┤
│    Service      │  ← 业务层
├─────────────────┤
│   Repository    │  ← 数据层
├─────────────────┤
│    Database     │  ← 存储层
└─────────────────┘
```

## 3. 数据库设计

**数据库**：MySQL 8.0  
**字符集**：utf8mb4  
**存储引擎**：InnoDB  

### 表设计

#### 3.1 用户表 (users)
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    phone VARCHAR(20),
    avatar_url VARCHAR(500),
    status TINYINT DEFAULT 1 COMMENT '1:正常 0:禁用',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by BIGINT,
    updated_by BIGINT,
    version INT DEFAULT 0,
    deleted TINYINT DEFAULT 0
);
```

#### 3.2 角色表 (roles)
```sql
CREATE TABLE roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_name VARCHAR(50) NOT NULL UNIQUE,
    role_code VARCHAR(50) NOT NULL UNIQUE,
    description VARCHAR(200),
    status TINYINT DEFAULT 1,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by BIGINT,
    updated_by BIGINT,
    version INT DEFAULT 0,
    deleted TINYINT DEFAULT 0
);
```

#### 3.3 权限表 (permissions)
```sql
CREATE TABLE permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    permission_name VARCHAR(100) NOT NULL,
    permission_code VARCHAR(100) NOT NULL UNIQUE,
    resource_type VARCHAR(50),
    resource_url VARCHAR(200),
    description VARCHAR(200),
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    version INT DEFAULT 0,
    deleted TINYINT DEFAULT 0
);
```

#### 3.4 用户角色关联表 (user_roles)
```sql
CREATE TABLE user_roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    role_id BIGINT NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by BIGINT,
    UNIQUE KEY uk_user_role (user_id, role_id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (role_id) REFERENCES roles(id)
);
```

#### 3.5 角色权限关联表 (role_permissions)
```sql
CREATE TABLE role_permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_id BIGINT NOT NULL,
    permission_id BIGINT NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by BIGINT,
    UNIQUE KEY uk_role_permission (role_id, permission_id),
    FOREIGN KEY (role_id) REFERENCES roles(id),
    FOREIGN KEY (permission_id) REFERENCES permissions(id)
);
```

### 索引设计
- users表：username、email唯一索引
- roles表：role_code唯一索引
- permissions表：permission_code唯一索引
- user_roles表：user_id、role_id复合索引
- role_permissions表：role_id、permission_id复合索引

## 4. API设计

**API风格**：RESTful API  
**数据格式**：JSON  
**认证方式**：JWT Token  
**版本控制**：URL路径版本控制 (/api/v1/)  

### 4.1 用户管理接口

#### 用户注册
- **POST** `/api/v1/users/register`
- **描述**：用户注册
- **请求体**：
```json
{
    "username": "string",
    "email": "string", 
    "password": "string",
    "fullName": "string",
    "phone": "string"
}
```

#### 用户登录
- **POST** `/api/v1/users/login`
- **描述**：用户登录
- **请求体**：
```json
{
    "username": "string",
    "password": "string"
}
```

#### 获取用户信息
- **GET** `/api/v1/users/{id}`
- **描述**：根据ID获取用户信息
- **路径参数**：id (用户ID)

#### 更新用户信息
- **PUT** `/api/v1/users/{id}`
- **描述**：更新用户信息
- **路径参数**：id (用户ID)

#### 删除用户
- **DELETE** `/api/v1/users/{id}`
- **描述**：删除用户（逻辑删除）
- **路径参数**：id (用户ID)

#### 用户列表查询
- **GET** `/api/v1/users`
- **描述**：分页查询用户列表
- **查询参数**：page, size, username, email, status

### 4.2 角色管理接口

#### 创建角色
- **POST** `/api/v1/roles`

#### 获取角色信息
- **GET** `/api/v1/roles/{id}`

#### 更新角色
- **PUT** `/api/v1/roles/{id}`

#### 删除角色
- **DELETE** `/api/v1/roles/{id}`

#### 角色列表
- **GET** `/api/v1/roles`

### 4.3 权限管理接口

#### 获取权限列表
- **GET** `/api/v1/permissions`

#### 用户权限查询
- **GET** `/api/v1/users/{id}/permissions`

#### 角色权限分配
- **POST** `/api/v1/roles/{id}/permissions`

## 5. 模块设计

### 5.1 用户模块 (UserModule)
**职责**：用户基本信息管理
**组件**：
- UserController：用户接口控制器
- UserService：用户业务逻辑
- UserRepository：用户数据访问

### 5.2 认证模块 (AuthModule)  
**职责**：用户认证和授权
**组件**：
- AuthController：认证接口控制器
- AuthService：认证业务逻辑
- JwtTokenProvider：JWT令牌管理

### 5.3 权限模块 (PermissionModule)
**职责**：权限和角色管理
**组件**：
- RoleController：角色管理控制器
- PermissionController：权限管理控制器
- RoleService：角色业务逻辑
- PermissionService：权限业务逻辑

## 6. 技术栈

### 后端技术
- **框架**：Spring Boot 2.7.8
- **安全**：Spring Security 5.7
- **数据访问**：Spring Data JPA 2.7
- **数据库连接池**：HikariCP
- **缓存**：Redis 6.0
- **消息队列**：RabbitMQ 3.9
- **文档**：Swagger 3.0

### 前端技术
- **框架**：Vue.js 3.2
- **UI组件**：Element Plus
- **状态管理**：Pinia
- **路由**：Vue Router 4
- **HTTP客户端**：Axios

### 数据库
- **主数据库**：MySQL 8.0
- **缓存数据库**：Redis 6.0

### 开发工具
- **构建工具**：Maven 3.8
- **版本控制**：Git
- **容器化**：Docker
- **API测试**：Postman

## 7. 安全设计

### 7.1 认证机制
- **JWT Token**：无状态认证
- **Token过期**：访问令牌2小时，刷新令牌7天
- **密码加密**：BCrypt加密存储

### 7.2 授权机制
- **RBAC模型**：基于角色的访问控制
- **权限粒度**：接口级权限控制
- **权限缓存**：Redis缓存用户权限

### 7.3 安全措施
- **输入验证**：所有输入参数验证
- **SQL注入防护**：使用参数化查询
- **XSS防护**：输出内容转义
- **CSRF防护**：CSRF Token验证

## 8. 部署设计

### 8.1 部署架构
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Nginx     │    │ Spring Boot │    │   MySQL     │
│  (反向代理)  │ -> │   (应用)     │ -> │  (数据库)    │
└─────────────┘    └─────────────┘    └─────────────┘
                           │
                   ┌─────────────┐
                   │    Redis    │
                   │   (缓存)     │
                   └─────────────┘
```

### 8.2 环境配置
- **开发环境**：本地开发，H2内存数据库
- **测试环境**：Docker容器，MySQL数据库
- **生产环境**：云服务器，MySQL集群

### 8.3 监控和日志
- **应用监控**：Spring Boot Actuator
- **日志管理**：Logback + ELK Stack
- **性能监控**：Micrometer + Prometheus

## 9. 性能设计

### 9.1 性能指标
- **响应时间**：API接口响应时间 < 500ms
- **并发用户**：支持1000个并发用户
- **数据库连接**：连接池最大50个连接

### 9.2 优化策略
- **数据库优化**：索引优化、查询优化
- **缓存策略**：Redis缓存热点数据
- **连接池**：数据库连接池优化
- **异步处理**：邮件发送等异步处理

这个技术设计文档包含了完整的系统设计信息，可以直接用于代码生成！
